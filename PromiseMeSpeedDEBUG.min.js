("undefined"===typeof self?this:self).SPromise=function(){"use strict";function r(b){b()}function t(b){b(this)}function w(){if(p){do l=!1,u.shift()();while(--p)}l=!1}function v(b){function a(a){0===f&&(d=a,f=2,null!==e&&("function"===typeof e?e(a):e.forEach(t,a),e=null),g=null,null!==c&&("function"===typeof c?c():c.forEach(r),c=null))}function h(a){0===f&&(d=a,f=1,null!==g&&("function"===typeof g?g(a):g.forEach(t,a),g=null),e=null,null!==c&&("function"===typeof c?c():c.forEach(r),c=null))}var d,f=0,e=null,g=null,
c=null,x={then:function(c,a){c&&"function"!==typeof c&&console.error(Object.prototype.toString.call(c)+" is not a valid function to be called after a successful promise");a&&"function"!==typeof a&&console.error(Object.prototype.toString.call(a)+" is not a valid function to be called after a rejected promise");return n(function(b,h){0===f?(c&&(null!==e?"function"===typeof e?e=[e,function(){b(c(d))}]:e.push(function(){b(c(d))}):e=function(){b(c(d))}),a&&(null!==g?"function"===typeof g?g=[g,function(){b(a(d))}]:
g.push(function(){b(a(d))}):g=function(){b(a(d))})):2===f?c&&b(c(d)):a&&h(a(d))})},"catch":function(c){c&&"function"!==typeof c&&console.error(Object.prototype.toString.call(c)+" is not a valid function to be called after a rejected promise");return n(function(a){0===f?(null!==g?"function"===typeof g?g=[g,function(){a(c(d))}]:g.push(function(){a(c(d))}):g=function(){a(c(d))},null!==e?"function"===typeof e?e=[e,a]:e.push(a):e=a):a(2===f?d:c(d))})},"finally":function(a){"function"!==typeof a&&console.error(Object.prototype.toString.call(a)+
" is not a valid function to be called 'finally' after promise");0===f?null!==c?"function"===typeof c?c=[c,a]:c.push(a):c=a:a();return x}};!1!==m&&(x[m]="Promise");l?(u.push(b.bind(null,a,h)),p++):(++k,128===k?(l=!0,b(a,h)):(b(a,h),l&&1===k&&w()),--k);return x}function n(b){var a,h=0,d=null,f=null,e=null,g={then:function(c,b){c&&"function"!==typeof c&&console.error(Object.prototype.toString.call(c)+" is not a valid function to be called after a successful promise");b&&"function"!==typeof b&&console.error(Object.prototype.toString.call(b)+
" is not a valid function to be called after a rejected promise");return v(function(e,g){0===h?(c&&(null!==d?"function"===typeof d?d=[d,function(){e(c(a))}]:d.push(function(){e(c(a))}):d=function(){e(c(a))}),b&&(null!==f?"function"===typeof f?f=[f,function(){e(b(a))}]:f.push(function(){e(b(a))}):f=function(){e(b(a))})):2===h?c&&e(c(a)):b&&g(b(a))})},"catch":function(c){c&&"function"!==typeof c&&console.error(Object.prototype.toString.call(c)+" is not a valid function to be called after a rejected promise");
return v(function(b){0===h?(null!==f?"function"===typeof f?f=[f,function(){b(c(a))}]:f.push(function(){b(c(a))}):f=function(){b(c(a))},null!==d?"function"===typeof d?d=[d,b]:d.push(b):d=b):b(2===h?a:c(a))})},"finally":function(a){"function"!==typeof a&&console.error(Object.prototype.toString.call(a)+" is not a valid function to be called 'finally' after promise");0===h?null!==e?"function"===typeof e?e=[e,a]:e.push(a):e=a:a();return g}};!1!==m&&(g[m]="Promise");b(function(c){0===h&&(a=c,h=2,null!==
d&&("function"===typeof d?d(c):d.forEach(t,c),d=null),f=null,null!==e&&("function"===typeof e?e():e.forEach(r),e=null))},function(c){0===h&&(a=c,h=1,null!==f&&("function"===typeof f?f(c):f.forEach(t,c),f=null),d=null,null!==e&&("function"===typeof e?e():e.forEach(r),e=null))});return g}function q(b){var a={then:function(a){if(l)return n(function(d){u.push(function(){d(a(b))});p++});++k;if(128===k){l=!0;var d=a(b)}else d=a(b),l&&1===k&&w();--k;return y(d)},"finally":function(b){l?(u.push(b),p++):(++k,
128===k?(l=!0,b()):(b(),l&&1===k&&w()),--k);return a},"catch":function(){return a}};!1!==m&&(a[m]="Promise");return a}function y(b){var a={then:function(a){return q(a(b))},"finally":function(){return a},"catch":function(){return a}};!1!==m&&(a[m]="Promise");return a}var u=[],z=n.isPromise=function(b){return!!b&&"function"===typeof b.then&&"function"===typeof b["catch"]&&"function"===typeof b["finally"]},k=0,l=!1,p=0,m=void 0!=typeof Symbol&&Symbol.toStringTag;n.resolve=y;n.reject=function(b){var a=
{then:function(h,d){return d?q(d(b)):a},"finally":function(){return a},"catch":function(a){return q(a(b))}};!1!==m&&(a[m]="Promise");return a};var A=!1;n.race=function(b){if(!b||!b.forEach)return console.error(Object.prototype.toString.call(b)+" is not a valid iterable array of promises. If you are using an array-like object, then you must call Array.prototype.slice.call on the object before passing it to SPromise.race."),q();A||b.length||(A=!0,console.warn(Object.prototype.toString.call(b)+" is an empty array of promises passed to SPromise"));
return v(function(a,h){var d=!1;b.forEach(function(b){!1===d&&(z(b)?b.then(function(b){!1===d&&(d=!0,a(b))},function(a){!1===d&&(d=!0,h(a))}):(d=!0,a(b)))})})};n.all=function(b){return b&&b.forEach?v(function(a,h){var d=0,f=[];b.forEach(function(b,g){z(b)?(d++,b.then(function(b){f[g]=b;--d||a(b)},function(a){0<d&&(d=-1,h(a))})):f[g]=b});d||a(f)}):(console.error(Object.prototype.toString.call(b)+" is not a valid iterable array of promises. If you are using an array-like object, then you must call Array.prototype.slice.call on the object before passing it to SPromise.all."),
q())};return n}();