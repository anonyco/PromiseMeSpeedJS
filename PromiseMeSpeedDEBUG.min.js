(function(){function r(b){b()}function t(b){b(this)}function e(q){function p(g){f=null;l=g;h=!0;null!==d&&(d.forEach(t,g),d=null);null!==m&&(m.forEach(r),m=null);f=null}function a(g){d=null;l=g;h=!1;null!==f&&(f.forEach(t,g),f=null);null!==m&&(m.forEach(r),m=null);f=d=m=null}var l,h,d=null,f=null,m=null;if(b)n.push(q.bind(void 0,p,a)),k++;else if(256===c)b=!0,q(p,a);else{++c;q(p,a);if(1===c){if(k){do b=!1,n.shift()();while(--k)}b=!1}--c}return{then:function(g,a){g&&"function"!==typeof g&&console.error(Object.prototype.toString.call(g)+
" is not valid function to be called after a successful promise");a&&"function"!==typeof a&&console.error(Object.prototype.toString.call(a)+" is not valid function to be called after a rejected promise");return e(function(b,c){void 0===h?(g&&(null!==d?d.push(g):d=[g]),a&&(null!==f?f.push(a):f=[a])):!0===h?g&&b(g(l)):a&&c(a(l))})},"catch":function(a){a&&"function"!==typeof a&&console.error(Object.prototype.toString.call(a)+" is not valid function to be called after a rejected promise");a&&(null!==
f?f.push(a):f=[a]);return e(function(b,d){void 0===h?a&&f.push(function(){return d(a(l))}):a&&d(a(l))})},"finally":function(a){"function"!==typeof a&&console.error(Object.prototype.toString.call(a)+" is not valid function to be called 'finally' after promise");void 0===h?m?m.push(a):m=[a]:a()}}}var n=[],v=window.Promise||Object.create(null);e.isPromise=function(b){return!!b&&(b.constructor===e||b.constructor===v)};var c=0,b=!1,k=0;e.resolve=function a(p){var l={then:function(h){if(b)return e(function(a){n.push(function(){a(h(p))});
k++});if(256===c){b=!0;var d=h(p)}else{++c;d=h(p);if(1===c){if(k){do b=!1,n.shift()();while(--k)}b=!1}--c}return a(d)},"finally":function(a){if(b)n.push(a),k++;else if(256===c)b=!0,a();else{++c;a();if(1===c&&b){do b=!1,n.shift()();while(--k);b=!1}--c}return l},"catch":function(){return l}};return l};e.reject=function l(a){var h={then:function(){return h},"finally":function(a){if(b)n.push(a),k++;else if(256===c)b=!0,a();else{++c;a();if(1===c){if(k){do b=!1,n.shift()();while(--k)}b=!1}--c}return h},
"catch":function(d){if(b)return e(function(b){n.push(function(){b(d(a))});k++});if(256===c){b=!0;var f=d(a)}else{++c;f=d(a);if(1===c){if(k){do b=!1,n.shift()();while(--k)}b=!1}--c}return l(f)}};return h};var u=!1;e.race=function(a){if(!a||!a.forEach||!Array.prototype.every.call(a,function(a){return e.a(a)}))return console.error(Object.prototype.toString.call(a)+" is not a valid iterable array of promises. If you are using an array-like object, then you must call Array.prototype.slice.call on the object before passing it to SPromise.race."),
e.resolve();u||a.length||(u=!0,console.warn(Object.prototype.toString.call(a)+" is an empty array of promises passed to SPromise"));return e(function(b){var c=!1;a.forEach(function(a){a.then(function(a){!1===c&&(c=!0,b(a),console.warn)})})})};e.all=function(a){return a&&a.forEach&&a.every&&a.every(function(a){return e.a(a)})?e(function(b){var c=a.length;a.forEach(function(a){a.then(function(a){--c||b(a)})})}):(console.error(Object.prototype.toString.call(a)+" is not a valid iterable array of promises. If you are using an array-like object, then you must call Array.prototype.slice.call on the object before passing it to Promise.race."),
e.resolve())};window.SPromise=e})();