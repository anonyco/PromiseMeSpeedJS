("undefined"===typeof self?this:self).SPromise=function(){"use strict";function q(e){e()}function r(e){e(this)}function v(){if(p){do l=!1,t.shift()();while(--p)}l=!1}function u(e){function a(a){0===f&&(c=a,f=2,null!==b&&("function"===typeof b?b(a):b.forEach(r,a),b=null),h=null,null!==d&&("function"===typeof d?d():d.forEach(q),d=null))}function g(a){0===f&&(c=a,f=1,null!==h&&("function"===typeof h?h(a):h.forEach(r,a),h=null),b=null,null!==d&&("function"===typeof d?d():d.forEach(q),d=null))}var c,f=0,b=null,h=null,
d=null,w={then:function(a,d){return n(function(g,e){0===f?(a&&(null!==b?"function"===typeof b?b=[b,function(){g(a(c))}]:b.push(function(){g(a(c))}):b=function(){g(a(c))}),d&&(null!==h?"function"===typeof h?h=[h,function(){g(d(c))}]:h.push(function(){g(d(c))}):h=function(){g(d(c))})):2===f?a&&g(a(c)):d&&e(d(c))})},"catch":function(a){return n(function(d){0===f?(null!==h?"function"===typeof h?h=[h,function(){d(a(c))}]:h.push(function(){d(a(c))}):h=function(){d(a(c))},null!==b?"function"===typeof b?
b=[b,d]:b.push(d):b=d):d(2===f?c:a(c))})},"finally":function(a){0===f?null!==d?"function"===typeof d?d=[d,a]:d.push(a):d=a:a();return w}};!1!==m&&(w[m]="Promise");l?(t.push(e.bind(null,a,g)),p++):(++k,128===k?(l=!0,e(a,g)):(e(a,g),l&&1===k&&v()),--k);return w}function n(e){var a,g=0,c=null,f=null,b=null,h={then:function(d,b){return u(function(e,h){0===g?(d&&(null!==c?"function"===typeof c?c=[c,function(){e(d(a))}]:c.push(function(){e(d(a))}):c=function(){e(d(a))}),b&&(null!==f?"function"===typeof f?
f=[f,function(){e(b(a))}]:f.push(function(){e(b(a))}):f=function(){e(b(a))})):2===g?d&&e(d(a)):b&&h(b(a))})},"catch":function(d){return u(function(b){0===g?(null!==f?"function"===typeof f?f=[f,function(){b(d(a))}]:f.push(function(){b(d(a))}):f=function(){b(d(a))},null!==c?"function"===typeof c?c=[c,b]:c.push(b):c=b):b(2===g?a:d(a))})},"finally":function(a){0===g?null!==b?"function"===typeof b?b=[b,a]:b.push(a):b=a:a();return h}};!1!==m&&(h[m]="Promise");e(function(d){0===g&&(a=d,g=2,null!==c&&("function"===
typeof c?c(d):c.forEach(r,d),c=null),f=null,null!==b&&("function"===typeof b?b():b.forEach(q),b=null))},function(d){0===g&&(a=d,g=1,null!==f&&("function"===typeof f?f(d):f.forEach(r,d),f=null),c=null,null!==b&&("function"===typeof b?b():b.forEach(q),b=null))});return h}function x(e){var a={then:function(a){if(l)return n(function(c){t.push(function(){c(a(e))});p++});++k;if(128===k){l=!0;var c=a(e)}else c=a(e),l&&1===k&&v();--k;return y(c)},"finally":function(e){l?(t.push(e),p++):(++k,128===k?(l=!0,
e()):(e(),l&&1===k&&v()),--k);return a},"catch":function(){return a}};!1!==m&&(a[m]="Promise");return a}function y(e){var a={then:function(a){return x(a(e))},"finally":function(){return a},"catch":function(){return a}};!1!==m&&(a[m]="Promise");return a}var t=[],z=n.isPromise=function(e){return!!e&&"function"===typeof e.then&&"function"===typeof e["catch"]&&"function"===typeof e["finally"]},k=0,l=!1,p=0,m=void 0!=typeof Symbol&&Symbol.toStringTag;n.resolve=y;n.reject=function(e){var a={then:function(g,
c){return c?x(c(e)):a},"finally":function(){return a},"catch":function(a){return x(a(e))}};!1!==m&&(a[m]="Promise");return a};n.race=function(e){return u(function(a,g){var c=!1;e.forEach(function(e){!1===c&&(z(e)?e.then(function(b){!1===c&&(c=!0,a(b))},function(a){!1===c&&(c=!0,g(a))}):(c=!0,a(e)))})})};n.all=function(e){return u(function(a,g){var c=0,f=[];e.forEach(function(b,e){z(b)?(c++,b.then(function(b){f[e]=b;--c||a(b)},function(a){0<c&&(c=-1,g(a))})):f[e]=b});c||a(f)})};return n}();